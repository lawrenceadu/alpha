!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Turbolinks=e()}(this,function(){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};function e(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t}).apply(this,arguments)};function o(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var i=function(){function t(t){var e=document.createElement("a");e.href=t,this.absoluteURL=e.href;var n=e.hash.length;n<2?this.requestURL=this.absoluteURL:(this.requestURL=this.absoluteURL.slice(0,-n),this.anchor=e.hash.slice(1))}return t.wrap=function(t){return"string"==typeof t?new this(t):null!=t?t:void 0},t.prototype.getOrigin=function(){return this.absoluteURL.split("/",3).join("/")},t.prototype.getPath=function(){return(this.requestURL.match(/\/\/[^/]*(\/[^?;]*)/)||[])[1]||"/"},t.prototype.getPathComponents=function(){return this.getPath().split("/").slice(1)},t.prototype.getLastPathComponent=function(){return this.getPathComponents().slice(-1)[0]},t.prototype.getExtension=function(){return(this.getLastPathComponent().match(/\.[^.]*$/)||[])[0]||""},t.prototype.isHTML=function(){return this.getExtension().match(/^(?:|\.(?:htm|html|xhtml))$/)},t.prototype.isPrefixedBy=function(t){var e,n,o,i,r,s=(n=(e=t).getOrigin()+e.getPath(),o="/",n.slice(-o.length)===o?n:n+"/");return this.isEqualTo(t)||(i=this.absoluteURL,r=s,i.slice(0,r.length)===r)},t.prototype.isEqualTo=function(t){return t&&this.absoluteURL===t.absoluteURL},t.prototype.toCacheKey=function(){return this.requestURL},t.prototype.toJSON=function(){return this.absoluteURL},t.prototype.toString=function(){return this.absoluteURL},t.prototype.valueOf=function(){return this.absoluteURL},t}();function r(t){return Array.prototype.slice.call(t)}var s,a,l,c=(s=document.documentElement,a=s.matches||s.webkitMatchesSelector||s.msMatchesSelector||s.mozMatchesSelector,l=s.closest||function(t){for(var e=this;e;){if(a.call(e,t))return e;e=e.parentElement}},function(t,e){return l.call(t,e)});function h(t){setTimeout(t,1)}function u(t,e){var n=void 0===e?{}:e,o=n.target,i=n.cancelable,r=n.data,s=document.createEvent("Events");if(s.initEvent(t,!0,1==i),s.data=r||{},s.cancelable&&!y){var a=s.preventDefault;s.preventDefault=function(){this.defaultPrevented||Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}}),a.call(this)}}return(o||document).dispatchEvent(s),s}var p,d,f,y=((p=document.createEvent("Events")).initEvent("test",!0,!0),p.preventDefault(),p.defaultPrevented);function m(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o,i,r,s=(i=t,r=e,o=i.reduce(function(t,e,n){var o=void 0==r[n]?"":r[n];return t+e+o},""),o.replace(/^\n/,"")).split("\n"),a=s[0].match(/^\s+/),l=a?a[0].length:0;return s.map(function(t){return t.slice(l)}).join("\n")}function g(){return Array.apply(null,{length:36}).map(function(t,e){return 8==e||13==e||18==e||23==e?"-":14==e?"4":19==e?(Math.floor(4*Math.random())+8).toString(16):Math.floor(15*Math.random()).toString(16)}).join("")}(f=d||(d={}))[f.networkFailure=0]="networkFailure",f[f.timeoutFailure=-1]="timeoutFailure";var v,w=function(){function t(t,e,n){var o=this;this.failed=!1,this.progress=0,this.sent=!1,this.requestProgressed=function(t){t.lengthComputable&&o.setProgress(t.loaded/t.total)},this.requestLoaded=function(){o.endRequest(function(t){if(t.status>=200&&t.status<300){var e=i.wrap(t.getResponseHeader("Turbolinks-Location"));o.delegate.requestCompletedWithResponse(t.responseText,e)}else o.failed=!0,o.delegate.requestFailedWithStatusCode(t.status,t.responseText)})},this.requestFailed=function(){o.endRequest(function(){o.failed=!0,o.delegate.requestFailedWithStatusCode(d.networkFailure)})},this.requestTimedOut=function(){o.endRequest(function(){o.failed=!0,o.delegate.requestFailedWithStatusCode(d.timeoutFailure)})},this.requestCanceled=function(){o.endRequest()},this.delegate=t,this.location=e,this.referrer=n,this.location=i.wrap(e),this.referrer=i.wrap(n),this.url=e.absoluteURL,this.createXHR()}return t.prototype.send=function(){this.xhr&&!this.sent&&(this.notifyApplicationBeforeRequestStart(),this.setProgress(0),this.xhr.send(),this.sent=!0,this.delegate.requestStarted())},t.prototype.cancel=function(){this.xhr&&this.sent&&this.xhr.abort()},t.prototype.notifyApplicationBeforeRequestStart=function(){u("turbolinks:request-start",{data:{url:this.url,xhr:this.xhr}})},t.prototype.notifyApplicationAfterRequestEnd=function(){u("turbolinks:request-end",{data:{url:this.url,xhr:this.xhr}})},t.prototype.createXHR=function(){var e=this.xhr=new XMLHttpRequest,n=this.referrer?this.referrer.absoluteURL:"",o=1e3*t.timeout;e.open("GET",this.url,!0),e.timeout=o,e.setRequestHeader("Accept","text/html, application/xhtml+xml"),e.setRequestHeader("Turbolinks-Referrer",n),e.onprogress=this.requestProgressed,e.onload=this.requestLoaded,e.onerror=this.requestFailed,e.ontimeout=this.requestTimedOut,e.onabort=this.requestCanceled},t.prototype.endRequest=function(t){void 0===t&&(t=function(){}),this.xhr&&(this.notifyApplicationAfterRequestEnd(),t(this.xhr),this.destroy())},t.prototype.setProgress=function(t){this.progress=t,this.delegate.requestProgressed(t)},t.prototype.destroy=function(){this.setProgress(1),this.delegate.requestFinished()},t.timeout=60,t}(),E=function(){function t(){var t=this;this.stylesheetElement=this.createStylesheetElement(),this.progressElement=this.createProgressElement(),this.hiding=!1,this.value=0,this.visible=!1,this.trickle=function(){t.setValue(t.value+Math.random()/100)}}return Object.defineProperty(t,"defaultCSS",{get:function(){return m(v||(v=o(["\n      .turbolinks-progress-bar {\n        position: fixed;\n        display: block;\n        top: 0;\n        left: 0;\n        height: 3px;\n        background: #0076ff;\n        z-index: 9999;\n        transition:\n          width ","ms ease-out,\n          opacity ","ms ","ms ease-in;\n        transform: translate3d(0, 0, 0);\n      }\n    "],["\n      .turbolinks-progress-bar {\n        position: fixed;\n        display: block;\n        top: 0;\n        left: 0;\n        height: 3px;\n        background: #0076ff;\n        z-index: 9999;\n        transition:\n          width ","ms ease-out,\n          opacity ","ms ","ms ease-in;\n        transform: translate3d(0, 0, 0);\n      }\n    "])),t.animationDuration,t.animationDuration/2,t.animationDuration/2)},enumerable:!0,configurable:!0}),t.prototype.show=function(){this.visible||(this.visible=!0,this.installStylesheetElement(),this.installProgressElement(),this.startTrickling())},t.prototype.hide=function(){var t=this;this.visible&&!this.hiding&&(this.hiding=!0,this.fadeProgressElement(function(){t.uninstallProgressElement(),t.stopTrickling(),t.visible=!1,t.hiding=!1}))},t.prototype.setValue=function(t){this.value=t,this.refresh()},t.prototype.installStylesheetElement=function(){document.head.insertBefore(this.stylesheetElement,document.head.firstChild)},t.prototype.installProgressElement=function(){this.progressElement.style.width="0",this.progressElement.style.opacity="1",document.documentElement.insertBefore(this.progressElement,document.body),this.refresh()},t.prototype.fadeProgressElement=function(e){this.progressElement.style.opacity="0",setTimeout(e,1.5*t.animationDuration)},t.prototype.uninstallProgressElement=function(){this.progressElement.parentNode&&document.documentElement.removeChild(this.progressElement)},t.prototype.startTrickling=function(){this.trickleInterval||(this.trickleInterval=window.setInterval(this.trickle,t.animationDuration))},t.prototype.stopTrickling=function(){window.clearInterval(this.trickleInterval),delete this.trickleInterval},t.prototype.refresh=function(){var t=this;requestAnimationFrame(function(){t.progressElement.style.width=10+90*t.value+"%"})},t.prototype.createStylesheetElement=function(){var e=document.createElement("style");return e.type="text/css",e.textContent=t.defaultCSS,e},t.prototype.createProgressElement=function(){var t=document.createElement("div");return t.className="turbolinks-progress-bar",t},t.animationDuration=300,t}(),b=function(){function t(t){var e=this;this.progressBar=new E,this.showProgressBar=function(){e.progressBar.show()},this.controller=t}return t.prototype.visitProposedToLocationWithAction=function(t,e){var n=g();this.controller.startVisitToLocationWithAction(t,e,n)},t.prototype.visitStarted=function(t){t.issueRequest(),t.changeHistory(),t.loadCachedSnapshot()},t.prototype.visitRequestStarted=function(t){this.progressBar.setValue(0),t.hasCachedSnapshot()||"restore"!=t.action?this.showProgressBarAfterDelay():this.showProgressBar()},t.prototype.visitRequestProgressed=function(t){this.progressBar.setValue(t.progress)},t.prototype.visitRequestCompleted=function(t){t.loadResponse()},t.prototype.visitRequestFailedWithStatusCode=function(t,e){switch(e){case d.networkFailure:case d.timeoutFailure:return this.reload();default:return t.loadResponse()}},t.prototype.visitRequestFinished=function(t){this.hideProgressBar()},t.prototype.visitCompleted=function(t){t.followRedirect()},t.prototype.pageInvalidated=function(){this.reload()},t.prototype.visitFailed=function(t){},t.prototype.visitRendered=function(t){},t.prototype.showProgressBarAfterDelay=function(){this.progressBarTimeout=window.setTimeout(this.showProgressBar,this.controller.progressBarDelay)},t.prototype.hideProgressBar=function(){this.progressBar.hide(),null!=this.progressBarTimeout&&(window.clearTimeout(this.progressBarTimeout),delete this.progressBarTimeout)},t.prototype.reload=function(){window.location.reload()},t}(),S=function(){function t(t){var e=this;this.started=!1,this.pageLoaded=!1,this.onPopState=function(t){if(e.shouldHandlePopState()){var n=t.state.turbolinks;if(n){var o=i.wrap(window.location.toString()),r=n.restorationIdentifier;e.delegate.historyPoppedToLocationWithRestorationIdentifier(o,r)}}},this.onPageLoad=function(t){h(function(){e.pageLoaded=!0})},this.delegate=t}return t.prototype.start=function(){this.started||(addEventListener("popstate",this.onPopState,!1),addEventListener("load",this.onPageLoad,!1),this.started=!0)},t.prototype.stop=function(){this.started&&(removeEventListener("popstate",this.onPopState,!1),removeEventListener("load",this.onPageLoad,!1),this.started=!1)},t.prototype.push=function(t,e){this.update(history.pushState,t,e)},t.prototype.replace=function(t,e){this.update(history.replaceState,t,e)},t.prototype.shouldHandlePopState=function(){return this.pageIsLoaded()},t.prototype.pageIsLoaded=function(){return this.pageLoaded||"complete"==document.readyState},t.prototype.update=function(t,e,n){var o={turbolinks:{restorationIdentifier:n}};t.call(history,o,"",e.absoluteURL)},t}(),L=function(){function t(t){var e=this;this.started=!1,this.onScroll=function(){e.updatePosition({x:window.pageXOffset,y:window.pageYOffset})},this.delegate=t}return t.prototype.start=function(){this.started||(addEventListener("scroll",this.onScroll,!1),this.onScroll(),this.started=!0)},t.prototype.stop=function(){this.started&&(removeEventListener("scroll",this.onScroll,!1),this.started=!1)},t.prototype.scrollToElement=function(t){t.scrollIntoView()},t.prototype.scrollToPosition=function(t){var e=t.x,n=t.y;window.scrollTo(e,n)},t.prototype.updatePosition=function(t){this.delegate.scrollPositionChanged(t)},t}(),P=function(){function t(t){this.keys=[],this.snapshots={},this.size=t}return t.prototype.has=function(t){return t.toCacheKey()in this.snapshots},t.prototype.get=function(t){if(this.has(t)){var e=this.read(t);return this.touch(t),e}},t.prototype.put=function(t,e){return this.write(t,e),this.touch(t),e},t.prototype.read=function(t){return this.snapshots[t.toCacheKey()]},t.prototype.write=function(t,e){this.snapshots[t.toCacheKey()]=e},t.prototype.touch=function(t){var e=t.toCacheKey(),n=this.keys.indexOf(e);n>-1&&this.keys.splice(n,1),this.keys.unshift(e),this.trim()},t.prototype.trim=function(){for(var t=0,e=this.keys.splice(this.size);t<e.length;t++){var n=e[t];delete this.snapshots[n]}},t}();var k=function(){function t(){}return t.prototype.renderView=function(t){this.delegate.viewWillRender(this.newBody),t(),this.delegate.viewRendered(this.newBody)},t.prototype.invalidateView=function(){this.delegate.viewInvalidated()},t.prototype.createScriptElement=function(t){if("false"==t.getAttribute("data-turbolinks-eval"))return t;var e=document.createElement("script");return e.textContent=t.textContent,e.async=!1,function(t,e){for(var n=0,o=r(e.attributes);n<o.length;n++){var i=o[n],s=i.name,a=i.value;t.setAttribute(s,a)}}(e,t),e},t}();var T=function(t){function n(e,n){var o,i=t.call(this)||this;return i.delegate=e,i.htmlElement=((o=document.createElement("html")).innerHTML=n,o),i.newHead=i.htmlElement.querySelector("head")||document.createElement("head"),i.newBody=i.htmlElement.querySelector("body")||document.createElement("body"),i}return e(n,t),n.render=function(t,e,n){return new this(t,n).render(e)},n.prototype.render=function(t){var e=this;this.renderView(function(){e.replaceHeadAndBody(),e.activateBodyScriptElements(),t()})},n.prototype.replaceHeadAndBody=function(){var t=document.documentElement,e=document.head,n=document.body;t.replaceChild(this.newHead,e),t.replaceChild(this.newBody,n)},n.prototype.activateBodyScriptElements=function(){for(var t=0,e=this.getScriptElements();t<e.length;t++){var n=e[t],o=n.parentNode;if(o){var i=this.createScriptElement(n);o.replaceChild(i,n)}}},n.prototype.getScriptElements=function(){return r(document.documentElement.querySelectorAll("script"))},n}(k),R=function(){function t(t){this.detailsByOuterHTML=t.reduce(function(t,e){var o,i,r=e.outerHTML,s=r in t?t[r]:{type:function(t){{if("script"==t.tagName.toLowerCase())return"script";if("style"==(n=(e=t).tagName.toLowerCase())||"link"==n&&"stylesheet"==e.getAttribute("rel"))return"stylesheet"}var e,n}(e),tracked:(i=e,"reload"==i.getAttribute("data-turbolinks-track")),elements:[]};return n({},t,((o={})[r]=n({},s,{elements:s.elements.concat([e])}),o))},{})}return t.fromHeadElement=function(t){return new this(t?r(t.children):[])},t.prototype.getTrackedElementSignature=function(){var t=this;return Object.keys(this.detailsByOuterHTML).filter(function(e){return t.detailsByOuterHTML[e].tracked}).join("")},t.prototype.getScriptElementsNotInDetails=function(t){return this.getElementsMatchingTypeNotInDetails("script",t)},t.prototype.getStylesheetElementsNotInDetails=function(t){return this.getElementsMatchingTypeNotInDetails("stylesheet",t)},t.prototype.getElementsMatchingTypeNotInDetails=function(t,e){var n=this;return Object.keys(this.detailsByOuterHTML).filter(function(t){return!(t in e.detailsByOuterHTML)}).map(function(t){return n.detailsByOuterHTML[t]}).filter(function(e){return e.type==t}).map(function(t){return t.elements[0]})},t.prototype.getProvisionalElements=function(){var t=this;return Object.keys(this.detailsByOuterHTML).reduce(function(e,n){var o=t.detailsByOuterHTML[n],i=o.type,r=o.tracked,s=o.elements;return null!=i||r?s.length>1?e.concat(s.slice(1)):e:e.concat(s)},[])},t.prototype.getMetaValue=function(t){var e=this.findMetaElementByName(t);return e?e.getAttribute("content"):null},t.prototype.findMetaElementByName=function(t){var e=this;return Object.keys(this.detailsByOuterHTML).reduce(function(n,o){var i,r,s=e.detailsByOuterHTML[o].elements[0];return r=t,"meta"==(i=s).tagName.toLowerCase()&&i.getAttribute("name")==r?s:n},void 0)},t}();var C=function(){function t(t,e){this.headDetails=t,this.bodyElement=e}return t.wrap=function(t){return t instanceof this?t:"string"==typeof t?this.fromHTMLString(t):this.fromHTMLElement(t)},t.fromHTMLString=function(t){var e=document.createElement("html");return e.innerHTML=t,this.fromHTMLElement(e)},t.fromHTMLElement=function(t){var e=t.querySelector("head"),n=t.querySelector("body")||document.createElement("body");return new this(R.fromHeadElement(e),n)},t.prototype.clone=function(){return new t(this.headDetails,this.bodyElement.cloneNode(!0))},t.prototype.getRootLocation=function(){var t=this.getSetting("root","/");return new i(t)},t.prototype.getCacheControlValue=function(){return this.getSetting("cache-control")},t.prototype.getElementForAnchor=function(t){try{return this.bodyElement.querySelector("[id='"+t+"'], a[name='"+t+"']")}catch(t){return null}},t.prototype.getPermanentElements=function(){return r(this.bodyElement.querySelectorAll("[id][data-turbolinks-permanent]"))},t.prototype.getPermanentElementById=function(t){return this.bodyElement.querySelector("#"+t+"[data-turbolinks-permanent]")},t.prototype.getPermanentElementsPresentInSnapshot=function(t){return this.getPermanentElements().filter(function(e){var n=e.id;return t.getPermanentElementById(n)})},t.prototype.findFirstAutofocusableElement=function(){return this.bodyElement.querySelector("[autofocus]")},t.prototype.hasAnchor=function(t){return null!=this.getElementForAnchor(t)},t.prototype.isPreviewable=function(){return"no-preview"!=this.getCacheControlValue()},t.prototype.isCacheable=function(){return"no-cache"!=this.getCacheControlValue()},t.prototype.isVisitable=function(){return"reload"!=this.getSetting("visit-control")},t.prototype.getSetting=function(t,e){var n=this.headDetails.getMetaValue("turbolinks-"+t);return null==n?e:n},t}(),A=function(t){function n(e,n,o,i){var r=t.call(this)||this;return r.delegate=e,r.currentSnapshot=n,r.currentHeadDetails=n.headDetails,r.newSnapshot=o,r.newHeadDetails=o.headDetails,r.newBody=o.bodyElement,r.isPreview=i,r}return e(n,t),n.render=function(t,e,n,o,i){return new this(t,n,o,i).render(e)},n.prototype.render=function(t){var e=this;this.shouldRender()?(this.mergeHead(),this.renderView(function(){e.replaceBody(),e.isPreview||e.focusFirstAutofocusableElement(),t()})):this.invalidateView()},n.prototype.mergeHead=function(){this.copyNewHeadStylesheetElements(),this.copyNewHeadScriptElements(),this.removeCurrentHeadProvisionalElements(),this.copyNewHeadProvisionalElements()},n.prototype.replaceBody=function(){var t=this.relocateCurrentBodyPermanentElements();this.activateNewBodyScriptElements(),this.assignNewBody(),this.replacePlaceholderElementsWithClonedPermanentElements(t)},n.prototype.shouldRender=function(){return this.newSnapshot.isVisitable()&&this.trackedElementsAreIdentical()},n.prototype.trackedElementsAreIdentical=function(){return this.currentHeadDetails.getTrackedElementSignature()==this.newHeadDetails.getTrackedElementSignature()},n.prototype.copyNewHeadStylesheetElements=function(){for(var t=0,e=this.getNewHeadStylesheetElements();t<e.length;t++){var n=e[t];document.head.appendChild(n)}},n.prototype.copyNewHeadScriptElements=function(){for(var t=0,e=this.getNewHeadScriptElements();t<e.length;t++){var n=e[t];document.head.appendChild(this.createScriptElement(n))}},n.prototype.removeCurrentHeadProvisionalElements=function(){for(var t=0,e=this.getCurrentHeadProvisionalElements();t<e.length;t++){var n=e[t];document.head.removeChild(n)}},n.prototype.copyNewHeadProvisionalElements=function(){for(var t=0,e=this.getNewHeadProvisionalElements();t<e.length;t++){var n=e[t];document.head.appendChild(n)}},n.prototype.relocateCurrentBodyPermanentElements=function(){var t=this;return this.getCurrentBodyPermanentElements().reduce(function(e,n){var o,i,r=t.newSnapshot.getPermanentElementById(n.id);if(r){var s=(o=n,(i=document.createElement("meta")).setAttribute("name","turbolinks-permanent-placeholder"),i.setAttribute("content",o.id),{element:i,permanentElement:o});return q(n,s.element),q(r,n),e.concat([s])}return e},[])},n.prototype.replacePlaceholderElementsWithClonedPermanentElements=function(t){for(var e=0,n=t;e<n.length;e++){var o=n[e];q(o.element,o.permanentElement.cloneNode(!0))}},n.prototype.activateNewBodyScriptElements=function(){for(var t=0,e=this.getNewBodyScriptElements();t<e.length;t++){var n=e[t];q(n,this.createScriptElement(n))}},n.prototype.assignNewBody=function(){document.body=this.newBody},n.prototype.focusFirstAutofocusableElement=function(){var t,e=this.newSnapshot.findFirstAutofocusableElement();(t=e)&&"function"==typeof t.focus&&e.focus()},n.prototype.getNewHeadStylesheetElements=function(){return this.newHeadDetails.getStylesheetElementsNotInDetails(this.currentHeadDetails)},n.prototype.getNewHeadScriptElements=function(){return this.newHeadDetails.getScriptElementsNotInDetails(this.currentHeadDetails)},n.prototype.getCurrentHeadProvisionalElements=function(){return this.currentHeadDetails.getProvisionalElements()},n.prototype.getNewHeadProvisionalElements=function(){return this.newHeadDetails.getProvisionalElements()},n.prototype.getCurrentBodyPermanentElements=function(){return this.currentSnapshot.getPermanentElementsPresentInSnapshot(this.newSnapshot)},n.prototype.getNewBodyScriptElements=function(){return r(this.newBody.querySelectorAll("script"))},n}(k);function q(t,e){var n=t.parentElement;if(n)return n.replaceChild(e,t)}var H,B,I,D,M=function(){function t(t){this.htmlElement=document.documentElement,this.delegate=t}return t.prototype.getRootLocation=function(){return this.getSnapshot().getRootLocation()},t.prototype.getElementForAnchor=function(t){return this.getSnapshot().getElementForAnchor(t)},t.prototype.getSnapshot=function(){return C.fromHTMLElement(this.htmlElement)},t.prototype.render=function(t,e){var n=t.snapshot,o=t.error,i=t.isPreview;this.markAsPreview(i),n?this.renderSnapshot(n,i,e):this.renderError(o,e)},t.prototype.markAsPreview=function(t){t?this.htmlElement.setAttribute("data-turbolinks-preview",""):this.htmlElement.removeAttribute("data-turbolinks-preview")},t.prototype.renderSnapshot=function(t,e,n){A.render(this.delegate,n,this.getSnapshot(),t,e||!1)},t.prototype.renderError=function(t,e){T.render(this.delegate,e,t||"")},t}();(B=H||(H={})).visitStart="visitStart",B.requestStart="requestStart",B.requestEnd="requestEnd",B.visitEnd="visitEnd",(D=I||(I={})).initialized="initialized",D.started="started",D.canceled="canceled",D.failed="failed",D.completed="completed";var F,V=function(){function t(t,e,n,o){void 0===o&&(o=g());var i=this;this.identifier=g(),this.timingMetrics={},this.followedRedirect=!1,this.historyChanged=!1,this.progress=0,this.scrolled=!1,this.snapshotCached=!1,this.state=I.initialized,this.performScroll=function(){i.scrolled||("restore"==i.action?i.scrollToRestoredPosition()||i.scrollToTop():i.scrollToAnchor()||i.scrollToTop(),i.scrolled=!0)},this.controller=t,this.location=e,this.action=n,this.adapter=t.adapter,this.restorationIdentifier=o}return t.prototype.start=function(){this.state==I.initialized&&(this.recordTimingMetric(H.visitStart),this.state=I.started,this.adapter.visitStarted(this))},t.prototype.cancel=function(){this.state==I.started&&(this.request&&this.request.cancel(),this.cancelRender(),this.state=I.canceled)},t.prototype.complete=function(){this.state==I.started&&(this.recordTimingMetric(H.visitEnd),this.state=I.completed,this.adapter.visitCompleted(this),this.controller.visitCompleted(this))},t.prototype.fail=function(){this.state==I.started&&(this.state=I.failed,this.adapter.visitFailed(this))},t.prototype.changeHistory=function(){if(!this.historyChanged){var t=this.location.isEqualTo(this.referrer)?"replace":this.action;this.getHistoryMethodForAction(t).call(this.controller,this.location,this.restorationIdentifier),this.historyChanged=!0}},t.prototype.issueRequest=function(){this.shouldIssueRequest()&&!this.request&&(this.progress=0,this.request=new w(this,this.location,this.referrer),this.request.send())},t.prototype.getCachedSnapshot=function(){var t=this.controller.getCachedSnapshotForLocation(this.location);if(t&&(!this.location.anchor||t.hasAnchor(this.location.anchor))&&("restore"==this.action||t.isPreviewable()))return t},t.prototype.hasCachedSnapshot=function(){return null!=this.getCachedSnapshot()},t.prototype.loadCachedSnapshot=function(){var t=this,e=this.getCachedSnapshot();if(e){var n=this.shouldIssueRequest();this.render(function(){t.cacheSnapshot(),t.controller.render({snapshot:e,isPreview:n},t.performScroll),t.adapter.visitRendered(t),n||t.complete()})}},t.prototype.loadResponse=function(){var t=this,e=this.request,n=this.response;e&&n&&this.render(function(){t.cacheSnapshot(),e.failed?(t.controller.render({error:t.response},t.performScroll),t.adapter.visitRendered(t),t.fail()):(t.controller.render({snapshot:C.fromHTMLString(n)},t.performScroll),t.adapter.visitRendered(t),t.complete())})},t.prototype.followRedirect=function(){this.redirectedToLocation&&!this.followedRedirect&&(this.location=this.redirectedToLocation,this.controller.replaceHistoryWithLocationAndRestorationIdentifier(this.redirectedToLocation,this.restorationIdentifier),this.followedRedirect=!0)},t.prototype.requestStarted=function(){this.recordTimingMetric(H.requestStart),this.adapter.visitRequestStarted(this)},t.prototype.requestProgressed=function(t){this.progress=t,this.adapter.visitRequestProgressed&&this.adapter.visitRequestProgressed(this)},t.prototype.requestCompletedWithResponse=function(t,e){this.response=t,this.redirectedToLocation=e,this.adapter.visitRequestCompleted(this)},t.prototype.requestFailedWithStatusCode=function(t,e){this.response=e,this.adapter.visitRequestFailedWithStatusCode(this,t)},t.prototype.requestFinished=function(){this.recordTimingMetric(H.requestEnd),this.adapter.visitRequestFinished(this)},t.prototype.scrollToRestoredPosition=function(){var t=this.restorationData?this.restorationData.scrollPosition:void 0;if(t)return this.controller.scrollToPosition(t),!0},t.prototype.scrollToAnchor=function(){if(null!=this.location.anchor)return this.controller.scrollToAnchor(this.location.anchor),!0},t.prototype.scrollToTop=function(){this.controller.scrollToPosition({x:0,y:0})},t.prototype.recordTimingMetric=function(t){this.timingMetrics[t]=(new Date).getTime()},t.prototype.getTimingMetrics=function(){return n({},this.timingMetrics)},t.prototype.getHistoryMethodForAction=function(t){switch(t){case"replace":return this.controller.replaceHistoryWithLocationAndRestorationIdentifier;case"advance":case"restore":return this.controller.pushHistoryWithLocationAndRestorationIdentifier}},t.prototype.shouldIssueRequest=function(){return"restore"!=this.action||!this.hasCachedSnapshot()},t.prototype.cacheSnapshot=function(){this.snapshotCached||(this.controller.cacheSnapshot(),this.snapshotCached=!0)},t.prototype.render=function(t){var e=this;this.cancelRender(),this.frame=requestAnimationFrame(function(){delete e.frame,t.call(e)})},t.prototype.cancelRender=function(){this.frame&&(cancelAnimationFrame(this.frame),delete this.frame)},t}(),x=function(){function t(){var t=this;this.adapter=new b(this),this.history=new S(this),this.restorationData={},this.scrollManager=new L(this),this.view=new M(this),this.cache=new P(10),this.enabled=!0,this.progressBarDelay=500,this.started=!1,this.pageLoaded=function(){t.lastRenderedLocation=t.location,t.notifyApplicationAfterPageLoad()},this.clickCaptured=function(){removeEventListener("click",t.clickBubbled,!1),addEventListener("click",t.clickBubbled,!1)},this.clickBubbled=function(e){if(t.enabled&&t.clickEventIsSignificant(e)){var n=t.getVisitableLinkForTarget(e.target);if(n){var o=t.getVisitableLocationForLink(n);if(o&&t.applicationAllowsFollowingLinkToLocation(n,o)){e.preventDefault();var i=t.getActionForLink(n);t.visit(o,{action:i})}}}}}return t.prototype.start=function(){t.supported&&!this.started&&(addEventListener("click",this.clickCaptured,!0),addEventListener("DOMContentLoaded",this.pageLoaded,!1),this.scrollManager.start(),this.startHistory(),this.started=!0,this.enabled=!0)},t.prototype.disable=function(){this.enabled=!1},t.prototype.stop=function(){this.started&&(removeEventListener("click",this.clickCaptured,!0),removeEventListener("DOMContentLoaded",this.pageLoaded,!1),this.scrollManager.stop(),this.stopHistory(),this.started=!1)},t.prototype.clearCache=function(){this.cache=new P(10)},t.prototype.visit=function(t,e){if(void 0===e&&(e={}),t=i.wrap(t),this.applicationAllowsVisitingLocation(t))if(this.locationIsVisitable(t)){var n=e.action||"advance";this.adapter.visitProposedToLocationWithAction(t,n)}else window.location.href=t.toString()},t.prototype.startVisitToLocationWithAction=function(e,n,o){if(t.supported){var r=this.getRestorationDataForIdentifier(o);this.startVisit(i.wrap(e),n,{restorationData:r})}else window.location.href=e.toString()},t.prototype.setProgressBarDelay=function(t){this.progressBarDelay=t},t.prototype.startHistory=function(){this.location=i.wrap(window.location.toString()),this.restorationIdentifier=g(),this.history.start(),this.history.replace(this.location,this.restorationIdentifier)},t.prototype.stopHistory=function(){this.history.stop()},t.prototype.pushHistoryWithLocationAndRestorationIdentifier=function(t,e){this.location=i.wrap(t),this.restorationIdentifier=e,this.history.push(this.location,this.restorationIdentifier)},t.prototype.replaceHistoryWithLocationAndRestorationIdentifier=function(t,e){this.location=i.wrap(t),this.restorationIdentifier=e,this.history.replace(this.location,this.restorationIdentifier)},t.prototype.historyPoppedToLocationWithRestorationIdentifier=function(t,e){if(this.enabled){this.location=t,this.restorationIdentifier=e;var n=this.getRestorationDataForIdentifier(e);this.startVisit(t,"restore",{restorationIdentifier:e,restorationData:n,historyChanged:!0})}else this.adapter.pageInvalidated()},t.prototype.getCachedSnapshotForLocation=function(t){var e=this.cache.get(t);return e?e.clone():e},t.prototype.shouldCacheSnapshot=function(){return this.view.getSnapshot().isCacheable()},t.prototype.cacheSnapshot=function(){var t=this;if(this.shouldCacheSnapshot()){this.notifyApplicationBeforeCachingSnapshot();var e=this.view.getSnapshot(),n=this.lastRenderedLocation;h(function(){return t.cache.put(n,e.clone())})}},t.prototype.scrollToAnchor=function(t){var e=this.view.getElementForAnchor(t);e?this.scrollToElement(e):this.scrollToPosition({x:0,y:0})},t.prototype.scrollToElement=function(t){this.scrollManager.scrollToElement(t)},t.prototype.scrollToPosition=function(t){this.scrollManager.scrollToPosition(t)},t.prototype.scrollPositionChanged=function(t){this.getCurrentRestorationData().scrollPosition=t},t.prototype.render=function(t,e){this.view.render(t,e)},t.prototype.viewInvalidated=function(){this.adapter.pageInvalidated()},t.prototype.viewWillRender=function(t){this.notifyApplicationBeforeRender(t)},t.prototype.viewRendered=function(){this.lastRenderedLocation=this.currentVisit.location,this.notifyApplicationAfterRender()},t.prototype.applicationAllowsFollowingLinkToLocation=function(t,e){return!this.notifyApplicationAfterClickingLinkToLocation(t,e).defaultPrevented},t.prototype.applicationAllowsVisitingLocation=function(t){return!this.notifyApplicationBeforeVisitingLocation(t).defaultPrevented},t.prototype.notifyApplicationAfterClickingLinkToLocation=function(t,e){return u("turbolinks:click",{target:t,data:{url:e.absoluteURL},cancelable:!0})},t.prototype.notifyApplicationBeforeVisitingLocation=function(t){return u("turbolinks:before-visit",{data:{url:t.absoluteURL},cancelable:!0})},t.prototype.notifyApplicationAfterVisitingLocation=function(t){return u("turbolinks:visit",{data:{url:t.absoluteURL}})},t.prototype.notifyApplicationBeforeCachingSnapshot=function(){return u("turbolinks:before-cache")},t.prototype.notifyApplicationBeforeRender=function(t){return u("turbolinks:before-render",{data:{newBody:t}})},t.prototype.notifyApplicationAfterRender=function(){return u("turbolinks:render")},t.prototype.notifyApplicationAfterPageLoad=function(t){return void 0===t&&(t={}),u("turbolinks:load",{data:{url:this.location.absoluteURL,timing:t}})},t.prototype.startVisit=function(t,e,n){this.currentVisit&&this.currentVisit.cancel(),this.currentVisit=this.createVisit(t,e,n),this.currentVisit.start(),this.notifyApplicationAfterVisitingLocation(t)},t.prototype.createVisit=function(t,e,o){var i=new V(this,t,e,o.restorationIdentifier);return i.restorationData=n({},o.restorationData||{}),i.historyChanged=!!o.historyChanged,i.referrer=this.location,i},t.prototype.visitCompleted=function(t){this.notifyApplicationAfterPageLoad(t.getTimingMetrics())},t.prototype.clickEventIsSignificant=function(t){return!(t.target&&t.target.isContentEditable||t.defaultPrevented||t.which>1||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)},t.prototype.getVisitableLinkForTarget=function(t){if(t instanceof Element&&this.elementIsVisitable(t))return c(t,"a[href]:not([target]):not([download])")},t.prototype.getVisitableLocationForLink=function(t){var e=new i(t.getAttribute("href")||"");if(this.locationIsVisitable(e))return e},t.prototype.getActionForLink=function(t){var e,n=t.getAttribute("data-turbolinks-action");return"advance"==(e=n)||"replace"==e||"restore"==e?n:"advance"},t.prototype.elementIsVisitable=function(t){var e=c(t,"[data-turbolinks]");return!e||"false"!=e.getAttribute("data-turbolinks")},t.prototype.locationIsVisitable=function(t){return t.isPrefixedBy(this.view.getRootLocation())&&t.isHTML()},t.prototype.getCurrentRestorationData=function(){return this.getRestorationDataForIdentifier(this.restorationIdentifier)},t.prototype.getRestorationDataForIdentifier=function(t){return t in this.restorationData||(this.restorationData[t]={}),this.restorationData[t]},t.supported=!!(window.history.pushState&&window.requestAnimationFrame&&window.addEventListener),t}(),N=new x,O={get supported(){return x.supported},controller:N,visit:function(t,e){N.visit(t,e)},clearCache:function(){N.clearCache()},setProgressBarDelay:function(t){N.setProgressBarDelay(t)},start:function(){N.start()}};return function(){var t=document.currentScript;if(t&&!t.hasAttribute("data-turbolinks-suppress-warning"))for(;t=t.parentElement;)if(t==document.body)return console.warn(m(F||(F=o(['\n        You are loading Turbolinks from a <script> element inside the <body> element. This is probably not what you meant to do!\n\n        Load your application’s JavaScript bundle inside the <head> element instead. <script> elements in <body> are evaluated with each page change.\n\n        For more information, see: https://github.com/turbolinks/turbolinks#working-with-script-elements\n\n        ——\n        Suppress this warning by adding a "data-turbolinks-suppress-warning" attribute to: %s\n      '],['\n        You are loading Turbolinks from a <script> element inside the <body> element. This is probably not what you meant to do!\n\n        Load your application’s JavaScript bundle inside the <head> element instead. <script> elements in <body> are evaluated with each page change.\n\n        For more information, see: https://github.com/turbolinks/turbolinks#working-with-script-elements\n\n        ——\n        Suppress this warning by adding a "data-turbolinks-suppress-warning" attribute to: %s\n      ']))),t.outerHTML)}(),window.Turbolinks||(window.Turbolinks=O,"function"==typeof define&&define.amd||"object"==typeof exports&&"undefined"!=typeof module||O.start()),O});